## 高性能网站建设指南

### 本书主旨

阐明如何通过修改前端来改善网站性能

### 灵活运用

本书介绍 14 个性能优化规则，但是并非每个规则都要应用于每个网站，也不是每个网站都应该按照同一种方式运行一个规则，但每个规则都值得考虑；

### 绪言

#### 前端性能的重要性

事实上，通常只有 10% ~ 20% 的最终用户响应时间是花在从 Web 服务器获取 HTML 文档并传送到浏览器中的。
如果希望有效减少页面的响应时间，必须关注剩余 80% ~ 90% 的最终用户体验；

而仅需花费 10% ~ 20% d的响应时间来下载 HTML 文档，80% ~ 90% 的时间花费在页面的组件上；

![image.png](http://upload-images.jianshu.io/upload_images/1993435-a2bfdf187a7ffe4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 第 1 章 减少 HTTP 请求

性能黄金法则揭示：只有 10% ~ 20% 的响应时间花费在接收所请求的 HTML 文档上，80% ~ 90% 的时间花费在为 HTML 文档所引用的组件（图片、脚本、样式表和 Falsh）上进行的 HTTP 请求上。

因此，改善响应时间的最简单途径就是减少组件的数量，由此就是减少 HTTP 请求的数量。

#### 图片地图 Image Maps

对于特定的小图片，可以使用图片地图技术将多张图片整合为一张以此减少 HTTP 请求；

![image.png](http://upload-images.jianshu.io/upload_images/1993435-3daac0808e385efb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

图片地图有两种类型：
- 服务器端图片地图
原理是将所有点击提交到同一个 URL ，然后传入用户点击的 x、y 坐标，Web 应用程序将其映射为适当的操作；

- 客户端图片地图
原理是通过 MAP 标签构建出不同矩形的区域，通过点击不同的区域映射不同的操作；

![image.png](http://upload-images.jianshu.io/upload_images/1993435-ba1229e8fbcf8e99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

图片地图的缺点是：

在定义图片地图的区域坐标时，采用手工方式很容易出错，并且只能定义矩形的形状；
同时，图片地图要求各个图片必须连续，一旦图片发生改变，需要修改整个图；

#### CSS Sprites

CSS Sprites 的原理是将多张小图整合为一张合成图，然后通过给不同元素设置 **background-position** 去指定 CSS Sprites 的偏移量；

#### 内联图片 Inline Images

通过 data: URL 模式可以在 Web 页面中包含图片而无需额外的 HTTP 请求；

其格式为：
```
data:[<mediatype>][;base64],<data>
```

![image.png](http://upload-images.jianshu.io/upload_images/1993435-dd389f6f9b859487.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

由于 data: URL 内联在页面中，在切换不同页面时不会缓存，所以一些变动不大的图片，如（公司 Logo），一般是使用 外部 CSS 并将内联图片作为背景；

虽然将内联图片放置在外部样式表中额外增加一个 HTTP 请求，但被缓存后可以得到额外的收益；

#### 合并脚本和样式表

如果将脚本和样式表分开到多个小文件，则每个文件都需要一个额外的 HTTP 请求，因此可以将这些单独的文件合并到一个文件中，减少 HTTP 请求以缩短最终的用户响应时间；

【注】对于 SPA 而言，由于 JS 的体量较大，在加载脚本时可能会让用户响应时间过长，因此出现了另一种分离脚本的技术，即按需加载；

